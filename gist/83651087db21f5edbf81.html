<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>HardenIIS.ps1</title>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
    <meta name="generator" content="Jekyll v4.2.2" />
    <meta property="og:title" content="HardenIIS.ps1" />
    <meta name="author" content="Tomáš Krupka" />
    <meta property="og:locale" content="en_US" />
    <meta
      name="description"
      content='# Add and Enable SSL 3.0 for client and server SCHANNEL communications md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.0 for client and server SCHANNEL communications md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.1 for client and server SCHANNEL communications md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -name &#39;Enabled&#39; -value 1 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.2 for client and server SCHANNEL communications md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -name &#39;Enabled&#39; -value 1 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Disable Multi-Protocol Unified Hello md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable PCT 1.0 md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable SSL 2.0 (PCI Compliance) md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # WARNING: If you disable SSL 3.0 the you may lock out some people still using # Windows XP with IE6/7. Without SSL 3.0 enabled, there is no protocol available # for these people to fall back. Safer shopping certifications may require that # you disable SSLv3. I suspect in mid 2015 this can safely disabled. # # Disable SSL 3.0 (PCI Compliance) #md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -Force #New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable insecure ciphers $insecureCiphers = &#39;NULL&#39;,&#39;RC2 40/128&#39;,&#39;RC2 56/128&#39;,&#39;RC2 128/128&#39;,&#39;RC4 40/128&#39;,&#39;RC4 56/128&#39;,&#39;RC4 64/128&#39;,&#39;DES 56/56&#39; Foreach ($insecureCipher in $insecureCiphers) { $key = (Get-Item HKLM:\).OpenSubKey(&#39;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&#39;, $true).CreateSubKey($insecureCipher) $key.SetValue(&#39;Enabled&#39;, 0, &#39;DWord&#39;) $key.close() Write-Host "$insecureCipher has been disabled" } # Enable new secure ciphers $secureCiphers = &#39;RC4 128/128&#39;,&#39;Triple DES 168/168&#39;,&#39;AES 128/128&#39;,&#39;AES 256/256&#39; Foreach ($secureCipher in $secureCiphers) { $key = (Get-Item HKLM:\).OpenSubKey(&#39;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&#39;, $true).CreateSubKey($secureCipher) New-ItemProperty -path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\$secureCipher" -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force $key.close() Write-Host "$secureCipher has been enabled" } # Set hashes configuration md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\MD5&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\MD5&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\SHA&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\SHA&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force # Set KeyExchangeAlgorithms configuration md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\Diffie-Hellman&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\Diffie-Hellman&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\PKCS&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\PKCS&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force # Set cipher suites order as secure as possible (Enables Perfect Forward Secrecy) New-ItemProperty -path &#39;HKLM:\SOFTWARE\Policies\Microsoft\Cryptography\Configuration\SSL\00010002&#39; -name &#39;Functions&#39; -value &#39;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA256,TLS_DHE_DSS_WITH_AES_128_CBC_SHA,TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_RC4_128_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA&#39; -PropertyType &#39;String&#39; -Force Write-Host &#39;After the system has been rebooted you can verify your server configuration at https://www.ssllabs.com/ssltest/&#39; Write-Host -ForegroundColor Red &#39;A computer restart is required to apply settings. Restart computer now?&#39; Restart-Computer -Force -Confirm'
    />
    <meta
      property="og:description"
      content='# Add and Enable SSL 3.0 for client and server SCHANNEL communications md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.0 for client and server SCHANNEL communications md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.1 for client and server SCHANNEL communications md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -name &#39;Enabled&#39; -value 1 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.2 for client and server SCHANNEL communications md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -name &#39;Enabled&#39; -value 1 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Disable Multi-Protocol Unified Hello md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable PCT 1.0 md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable SSL 2.0 (PCI Compliance) md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # WARNING: If you disable SSL 3.0 the you may lock out some people still using # Windows XP with IE6/7. Without SSL 3.0 enabled, there is no protocol available # for these people to fall back. Safer shopping certifications may require that # you disable SSLv3. I suspect in mid 2015 this can safely disabled. # # Disable SSL 3.0 (PCI Compliance) #md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -Force #New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable insecure ciphers $insecureCiphers = &#39;NULL&#39;,&#39;RC2 40/128&#39;,&#39;RC2 56/128&#39;,&#39;RC2 128/128&#39;,&#39;RC4 40/128&#39;,&#39;RC4 56/128&#39;,&#39;RC4 64/128&#39;,&#39;DES 56/56&#39; Foreach ($insecureCipher in $insecureCiphers) { $key = (Get-Item HKLM:\).OpenSubKey(&#39;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&#39;, $true).CreateSubKey($insecureCipher) $key.SetValue(&#39;Enabled&#39;, 0, &#39;DWord&#39;) $key.close() Write-Host "$insecureCipher has been disabled" } # Enable new secure ciphers $secureCiphers = &#39;RC4 128/128&#39;,&#39;Triple DES 168/168&#39;,&#39;AES 128/128&#39;,&#39;AES 256/256&#39; Foreach ($secureCipher in $secureCiphers) { $key = (Get-Item HKLM:\).OpenSubKey(&#39;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&#39;, $true).CreateSubKey($secureCipher) New-ItemProperty -path "HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\$secureCipher" -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force $key.close() Write-Host "$secureCipher has been enabled" } # Set hashes configuration md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\MD5&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\MD5&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\SHA&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\SHA&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force # Set KeyExchangeAlgorithms configuration md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\Diffie-Hellman&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\Diffie-Hellman&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\PKCS&#39; -Force New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\PKCS&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force # Set cipher suites order as secure as possible (Enables Perfect Forward Secrecy) New-ItemProperty -path &#39;HKLM:\SOFTWARE\Policies\Microsoft\Cryptography\Configuration\SSL\00010002&#39; -name &#39;Functions&#39; -value &#39;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA256,TLS_DHE_DSS_WITH_AES_128_CBC_SHA,TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_RC4_128_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA&#39; -PropertyType &#39;String&#39; -Force Write-Host &#39;After the system has been rebooted you can verify your server configuration at https://www.ssllabs.com/ssltest/&#39; Write-Host -ForegroundColor Red &#39;A computer restart is required to apply settings. Restart computer now?&#39; Restart-Computer -Force -Confirm'
    />
    <link
      rel="canonical"
      href="https://parttimelegend.github.io/gistbook/gist/83651087db21f5edbf81"
    />
    <meta
      property="og:url"
      content="https://parttimelegend.github.io/gistbook/gist/83651087db21f5edbf81"
    />
    <meta property="og:site_name" content="Gistbook" />
    <meta property="og:type" content="article" />
    <meta
      property="article:published_time"
      content="2016-07-07T12:06:17+00:00"
    />
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="HardenIIS.ps1" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": { "@type": "Person", "name": "Tomáš Krupka" },
        "dateModified": "2016-07-07T12:06:17+00:00",
        "datePublished": "2016-07-07T12:06:17+00:00",
        "description": "# Add and Enable SSL 3.0 for client and server SCHANNEL communications md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.0 for client and server SCHANNEL communications md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.1 for client and server SCHANNEL communications md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Server&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Client&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Client&#39; -name &#39;Enabled&#39; -value 1 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Client&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Add and Enable TLS 1.2 for client and server SCHANNEL communications md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Server&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Client&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Client&#39; -name &#39;Enabled&#39; -value 1 -PropertyType &#39;DWord&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Client&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force # Disable Multi-Protocol Unified Hello md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\Multi-Protocol Unified Hello\\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\Multi-Protocol Unified Hello\\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable PCT 1.0 md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\PCT 1.0&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\PCT 1.0\\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\PCT 1.0\\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable SSL 2.0 (PCI Compliance) md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0\\Server&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0\\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # WARNING: If you disable SSL 3.0 the you may lock out some people still using # Windows XP with IE6/7. Without SSL 3.0 enabled, there is no protocol available # for these people to fall back. Safer shopping certifications may require that # you disable SSLv3. I suspect in mid 2015 this can safely disabled. # # Disable SSL 3.0 (PCI Compliance) #md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Server&#39; -Force #New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force # Disable insecure ciphers $insecureCiphers = &#39;NULL&#39;,&#39;RC2 40/128&#39;,&#39;RC2 56/128&#39;,&#39;RC2 128/128&#39;,&#39;RC4 40/128&#39;,&#39;RC4 56/128&#39;,&#39;RC4 64/128&#39;,&#39;DES 56/56&#39; Foreach ($insecureCipher in $insecureCiphers) { $key = (Get-Item HKLM:\\).OpenSubKey(&#39;SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Ciphers&#39;, $true).CreateSubKey($insecureCipher) $key.SetValue(&#39;Enabled&#39;, 0, &#39;DWord&#39;) $key.close() Write-Host &quot;$insecureCipher has been disabled&quot; } # Enable new secure ciphers $secureCiphers = &#39;RC4 128/128&#39;,&#39;Triple DES 168/168&#39;,&#39;AES 128/128&#39;,&#39;AES 256/256&#39; Foreach ($secureCipher in $secureCiphers) { $key = (Get-Item HKLM:\\).OpenSubKey(&#39;SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Ciphers&#39;, $true).CreateSubKey($secureCipher) New-ItemProperty -path &quot;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Ciphers\\$secureCipher&quot; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force $key.close() Write-Host &quot;$secureCipher has been enabled&quot; } # Set hashes configuration md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Hashes\\MD5&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Hashes\\MD5&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Hashes\\SHA&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Hashes\\SHA&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force # Set KeyExchangeAlgorithms configuration md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\KeyExchangeAlgorithms\\Diffie-Hellman&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\KeyExchangeAlgorithms\\Diffie-Hellman&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force md &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\KeyExchangeAlgorithms\\PKCS&#39; -Force New-ItemProperty -path &#39;HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\KeyExchangeAlgorithms\\PKCS&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force # Set cipher suites order as secure as possible (Enables Perfect Forward Secrecy) New-ItemProperty -path &#39;HKLM:\\SOFTWARE\\Policies\\Microsoft\\Cryptography\\Configuration\\SSL\\00010002&#39; -name &#39;Functions&#39; -value &#39;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA256,TLS_DHE_DSS_WITH_AES_128_CBC_SHA,TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_RC4_128_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA&#39; -PropertyType &#39;String&#39; -Force Write-Host &#39;After the system has been rebooted you can verify your server configuration at https://www.ssllabs.com/ssltest/&#39; Write-Host -ForegroundColor Red &#39;A computer restart is required to apply settings. Restart computer now?&#39; Restart-Computer -Force -Confirm",
        "headline": "HardenIIS.ps1",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://parttimelegend.github.io/gistbook/gist/83651087db21f5edbf81"
        },
        "url": "https://parttimelegend.github.io/gistbook/gist/83651087db21f5edbf81"
      }
    </script>
    <!-- End Jekyll SEO tag -->
    <link
      type="application/atom+xml"
      rel="alternate"
      href="https://parttimelegend.github.io/gistbook/feed.xml"
      title="Gistbook"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/gistbook/logo.png" />
    <link rel="stylesheet" href="/gistbook/assets/css/main.css" />
  </head>
  <body a="auto">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/gistbook/">home</a>
        <article>
          <p class="post-meta">
            <time datetime="2016-07-07 12:06:17 +0000">2016-07-07</time>
          </p>

          <h1>HardenIIS.ps1</h1>
          <noscript>
            <pre>
# Add and Enable SSL 3.0 for client and server SCHANNEL communications
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0&#39; -Force
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force
 
# Add and Enable TLS 1.0 for client and server SCHANNEL communications
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0&#39; -Force
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force
 
# Add and Enable TLS 1.1 for client and server SCHANNEL communications
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1&#39; -Force
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -Force
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -name &#39;Enabled&#39; -value 1 -PropertyType &#39;DWord&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force
 
# Add and Enable TLS 1.2 for client and server SCHANNEL communications
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2&#39; -Force
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -Force
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -name &#39;Enabled&#39; -value 1 -PropertyType &#39;DWord&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&#39; -name &#39;DisabledByDefault&#39; -value 0 -PropertyType &#39;DWord&#39; -Force
 
# Disable Multi-Protocol Unified Hello
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force
 
# Disable PCT 1.0
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0&#39; -Force
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force
 
# Disable SSL 2.0 (PCI Compliance)
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force
 
# WARNING: If you disable SSL 3.0 the you may lock out some people still using
# Windows XP with IE6/7. Without SSL 3.0 enabled, there is no protocol available
# for these people to fall back. Safer shopping certifications may require that
# you disable SSLv3. I suspect in mid 2015 this can safely disabled.
#
# Disable SSL 3.0 (PCI Compliance)
#md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -Force
#New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&#39; -name Enabled -value 0 -PropertyType &#39;DWord&#39; -Force
 
# Disable insecure ciphers
$insecureCiphers = &#39;NULL&#39;,&#39;RC2 40/128&#39;,&#39;RC2 56/128&#39;,&#39;RC2 128/128&#39;,&#39;RC4 40/128&#39;,&#39;RC4 56/128&#39;,&#39;RC4 64/128&#39;,&#39;DES 56/56&#39;
Foreach ($insecureCipher in $insecureCiphers) {
  $key = (Get-Item HKLM:\).OpenSubKey(&#39;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&#39;, $true).CreateSubKey($insecureCipher)
  $key.SetValue(&#39;Enabled&#39;, 0, &#39;DWord&#39;)
  $key.close()
  Write-Host &quot;$insecureCipher has been disabled&quot;
}
 
# Enable new secure ciphers
$secureCiphers = &#39;RC4 128/128&#39;,&#39;Triple DES 168/168&#39;,&#39;AES 128/128&#39;,&#39;AES 256/256&#39;
Foreach ($secureCipher in $secureCiphers) {
  $key = (Get-Item HKLM:\).OpenSubKey(&#39;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&#39;, $true).CreateSubKey($secureCipher)
  New-ItemProperty -path &quot;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\$secureCipher&quot; -name &#39;Enabled&#39; -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
  $key.close()
  Write-Host &quot;$secureCipher has been enabled&quot;
}
 
# Set hashes configuration
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\MD5&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\MD5&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
 
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\SHA&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\SHA&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
 
# Set KeyExchangeAlgorithms configuration
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\Diffie-Hellman&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\Diffie-Hellman&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
 
md &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\PKCS&#39; -Force
New-ItemProperty -path &#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\PKCS&#39; -name Enabled -value &#39;0xffffffff&#39; -PropertyType &#39;DWord&#39; -Force
 
# Set cipher suites order as secure as possible (Enables Perfect Forward Secrecy)
New-ItemProperty -path &#39;HKLM:\SOFTWARE\Policies\Microsoft\Cryptography\Configuration\SSL\00010002&#39; -name &#39;Functions&#39; -value &#39;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA256,TLS_DHE_DSS_WITH_AES_128_CBC_SHA,TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_RC4_128_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA&#39; -PropertyType &#39;String&#39; -Force
 
Write-Host &#39;After the system has been rebooted you can verify your server configuration at https://www.ssllabs.com/ssltest/&#39;
Write-Host -ForegroundColor Red &#39;A computer restart is required to apply settings. Restart computer now?&#39;
Restart-Computer -Force -Confirm</pre
            >
          </noscript>
          <script src="https://gist.github.com/PartTimeLegend/83651087db21f5edbf81.js"></script>
        </article>
      </div>
    </main>
  </body>
</html>
